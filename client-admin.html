<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client gallery admin – Bozzani Vision</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --burnt-orange: #d4521e;
            --desert-tan: #c4a57b;
            --off-white: #f5f5f0;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a1a;
            color: var(--off-white);
            padding: 3rem 2rem;
            max-width: 720px;
            margin: 0 auto;
        }
        h1 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2rem;
            letter-spacing: 0.1em;
            margin-bottom: 0.5rem;
        }
        p.sub {
            color: var(--desert-tan);
            font-size: 0.95rem;
            margin-bottom: 2rem;
        }
        a.back {
            color: var(--desert-tan);
            text-decoration: none;
            font-size: 0.9rem;
            letter-spacing: 0.05em;
            margin-bottom: 2rem;
            display: inline-block;
        }
        a.back:hover { color: var(--burnt-orange); }
        .form-group {
            margin-bottom: 1.25rem;
        }
        .form-group label {
            display: block;
            font-size: 0.85rem;
            color: var(--desert-tan);
            margin-bottom: 0.4rem;
            letter-spacing: 0.05em;
        }
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 0.65rem 0.9rem;
            background: #252525;
            border: 1px solid rgba(196, 165, 123, 0.4);
            border-radius: 4px;
            color: var(--off-white);
            font-family: inherit;
            font-size: 1rem;
        }
        .form-group input:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--burnt-orange);
        }
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        .form-group .hint {
            font-size: 0.8rem;
            color: rgba(196, 165, 123, 0.8);
            margin-top: 0.35rem;
        }
        .row {
            display: flex;
            gap: 0.75rem;
            align-items: flex-end;
        }
        .row .form-group { flex: 1; }
        .btn {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 0.95rem;
            letter-spacing: 0.1em;
            padding: 0.55rem 1.25rem;
            background: var(--burnt-orange);
            border: none;
            color: var(--off-white);
            cursor: pointer;
            border-radius: 4px;
            transition: background 0.2s;
        }
        .btn:hover { background: #b84518; }
        .btn-secondary {
            background: transparent;
            border: 1px solid rgba(196, 165, 123, 0.5);
            color: var(--desert-tan);
        }
        .btn-secondary:hover {
            border-color: var(--burnt-orange);
            color: var(--burnt-orange);
        }
        .output-section {
            margin-top: 2.5rem;
            padding: 1.25rem;
            background: #252525;
            border: 1px solid rgba(196, 165, 123, 0.25);
            border-radius: 8px;
        }
        .output-section h2 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.2rem;
            letter-spacing: 0.1em;
            color: var(--desert-tan);
            margin-bottom: 0.75rem;
        }
        .output-section pre {
            font-size: 0.8rem;
            color: var(--off-white);
            white-space: pre-wrap;
            word-break: break-all;
            margin-bottom: 1rem;
        }
        .output-section .instructions {
            font-size: 0.9rem;
            color: var(--desert-tan);
            line-height: 1.6;
            margin-top: 1rem;
        }
        .output-section .copy-btn {
            margin-top: 0.5rem;
        }
        .client-link-box {
            margin-top: 1rem;
            padding: 0.75rem 1rem;
            background: rgba(26,26,26,0.8);
            border-radius: 4px;
            font-size: 0.9rem;
        }
        .client-link-box strong { color: var(--desert-tan); }
    </style>
</head>
<body>
    <a href="photography.html" class="back">← Back to Photography</a>
    <h1>Client gallery admin</h1>
    <p class="sub">Create new client galleries and generate access codes. Add the output to <code>client-config.json</code>, create the folder, add photos, then run <code>build_client_manifests.py</code> to scan the folder.</p>

    <form id="admin-form">
        <div class="form-group">
            <label for="folder">Client folder name</label>
            <input type="text" id="folder" placeholder="e.g. acme-wedding-2025" required pattern="[a-zA-Z0-9_-]+" title="Letters, numbers, hyphens, underscores only">
            <p class="hint">Create this folder: images/PHOTOGRAPHY/CLIENT/<strong>[folder]</strong>/ — all images inside will be shown automatically after you run the build script.</p>
        </div>
        <div class="row">
            <div class="form-group">
                <label for="accessCode">Access code</label>
                <input type="text" id="accessCode" placeholder="e.g. acme2025" autocomplete="off">
            </div>
            <button type="button" class="btn btn-secondary" id="generate-code">Generate code</button>
        </div>
        <div class="form-group">
            <label for="expiresAt">Expiration date</label>
            <input type="date" id="expiresAt">
            <p class="hint">Leave empty for no expiration. Format: YYYY-MM-DD.</p>
        </div>
        <div class="form-group">
            <label for="password">Password (optional)</label>
            <input type="text" id="password" placeholder="Optional second factor or note" autocomplete="off">
        </div>
        <button type="submit" class="btn">Generate config entry</button>
    </form>

    <div class="output-section" id="output-section" style="display: none;">
        <h2>Config entry</h2>
        <p class="instructions">Add this block to <code>client-config.json</code> inside <code>"clients"</code>. Then create the folder, add your photos, and run <code>python3 build_client_manifests.py</code> so the gallery picks up the images.</p>
        <pre id="config-output"></pre>
        <button type="button" class="btn btn-secondary copy-btn" id="copy-btn">Copy JSON</button>
        <div class="client-link-box" id="client-link-box">
            <strong>Send to client:</strong><br>
            Photography page: <a href="photography.html" style="color: var(--burnt-orange);">photography.html</a> → click CLIENT → enter code: <strong id="code-to-send"></strong>
        </div>
    </div>

    <div class="output-section" style="margin-top: 1.5rem;">
        <h2>Steps</h2>
        <ol class="instructions" style="padding-left: 1.25rem;">
            <li>Fill the form and click “Generate config entry”.</li>
            <li>Open <code>client-config.json</code> and add the generated JSON inside <code>"clients"</code> (comma after existing entries).</li>
            <li>Create folder: <code>images/PHOTOGRAPHY/CLIENT/<strong>[folder name]</strong>/</code> and add your photo files (jpg, png, gif, webp).</li>
            <li>Run <code>python3 build_client_manifests.py</code> to scan all client folders and update <code>client-manifests.json</code>.</li>
            <li>Send the client the photography page link and their access code.</li>
        </ol>
    </div>

    <script>
        (function() {
            var form = document.getElementById('admin-form');
            var folderInput = document.getElementById('folder');
            var accessCodeInput = document.getElementById('accessCode');
            var expiresAtInput = document.getElementById('expiresAt');
            var outputSection = document.getElementById('output-section');
            var configOutput = document.getElementById('config-output');
            var copyBtn = document.getElementById('copy-btn');
            var codeToSend = document.getElementById('code-to-send');

            function generateRandomCode() {
                var chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
                var s = '';
                for (var i = 0; i < 8; i++) s += chars.charAt(Math.floor(Math.random() * chars.length));
                return s;
            }

            document.getElementById('generate-code').addEventListener('click', function() {
                accessCodeInput.value = generateRandomCode();
            });

            var passwordInput = document.getElementById('password');

            form.addEventListener('submit', function(e) {
                e.preventDefault();
                var folder = (folderInput.value || '').trim().replace(/\s+/g, '-');
                var accessCode = (accessCodeInput.value || '').trim() || generateRandomCode();
                var expiresAt = (expiresAtInput.value || '').trim();
                var password = (passwordInput && passwordInput.value) ? (passwordInput.value || '').trim() : '';

                var entry = {
                    displayName: folder.replace(/-/g, ' ').replace(/\b\w/g, function(c) { return c.toUpperCase(); }),
                    accessCode: accessCode,
                    expiresAt: expiresAt || undefined,
                    password: password || undefined
                };
                if (entry.expiresAt === undefined) delete entry.expiresAt;
                if (entry.password === undefined) delete entry.password;

                var json = '"' + folder + '": ' + JSON.stringify(entry, null, 2);
                configOutput.textContent = json;
                codeToSend.textContent = accessCode;
                outputSection.style.display = 'block';
            });

            copyBtn.addEventListener('click', function() {
                var pre = configOutput;
                var range = document.createRange();
                range.selectNodeContents(pre);
                var sel = window.getSelection();
                sel.removeAllRanges();
                sel.addRange(range);
                document.execCommand('copy');
                sel.removeAllRanges();
                copyBtn.textContent = 'Copied';
                setTimeout(function() { copyBtn.textContent = 'Copy JSON'; }, 2000);
            });
        })();
    </script>
</body>
</html>
